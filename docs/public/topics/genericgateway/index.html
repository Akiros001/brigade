<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Generic Gateway - Brigade</title>
<meta name="description" content="About Brigade&#39;s generic gateway.">
<meta name="generator" content="Hugo 0.54.0" />
<link href="/index.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="/topics/genericgateway/">
<link rel="stylesheet" href="/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="/js/functions.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="/js/jquery.backtothetop/jquery.backtothetop.min.js"></script></head>
<body>
<div class="container"><header>
<h1>Brigade</h1>

<p class="description">Brigade - Event-driven scripting for Kubernetes.</p>
<div class="menu">
<nav>
<ul>
<li><a href="https://docs.brigade.sh">Docs</a></li>
<li><a href="https://github.com/Azure/brigade/tree/master/docs/content/examples">Examples</a></li>
<li><a href="https://github.com/azure/brigade">Github</a></li></ul>
</nav>
</div>
</header>
<div class="content-container">
<main>
  <article class="content-wrap"><h1>Generic Gateway</h1>

<h1 id="generic-gateway">Generic Gateway</h1>

<p>Brigade contains a Generic Gateway that can be used to accept requests from other platforms or systems. Generic Gateway is a separate component in the Brigade system, like Github and Container Registry (CR) Gateways.</p>

<p>Generic Gateway is <em>not enabled by default</em> and provides Brigade developers with the ability to trigger scripts based on messages received from any platform that can send a POST HTTP request.</p>

<h2 id="intro-to-generic-gateway">Intro to Generic Gateway</h2>

<p>Generic Gateway listens and accepts <code>POST</code> JSON messages at two different endpoints, <code>/simpleevents/v1/:projectID/:secret</code> and <code>/cloudevents/v02/:projectID/:secret</code>. When one of these endpoints is called, Brigade will respond by creating a Build with a <code>simpleevent</code> event or a <code>cloudevent</code> one, respectively.</p>

<h3 id="simpleevent">SimpleEvent</h3>

<p>Generic Gateway accepts valid JSON objects (thereafter called <code>SimpleEvent</code>) at the <code>/simpleevents/v1/:projectID/:secret</code> endpoint. Here&rsquo;s a sample JSON object:</p>

<pre><code class="language-json">{
    &quot;ref&quot;: &quot;refs/heads/changes&quot;,
    &quot;commit&quot;: &quot;b60ad9543b2ddbbe73430dd6898b75883306cecc&quot;
}
</code></pre>

<p>We are using <code>v1</code> in the endpoint path in case we want to have another version of <code>SimpleEvent</code> in the future.</p>

<h3 id="cloudevent">CloudEvent</h3>

<p>Generic Gateway accepts <a href="https://cloudevents.io/">CloudEvents</a> messages at the <code>/cloudevents/v02/:projectID/:secret</code> endpoint. As you can understand from the endpoint path, Generic Gateway currently supports <a href="https://github.com/cloudevents/spec/blob/v0.2/spec.md">version 0.2</a> of the <a href="https://github.com/cloudevents/spec">CloudEvents specification</a>, using the <a href="https://github.com/cloudevents/sdk-go">CloudEvents Go SDK</a>. CloudEvent messages should be JSON encoded and transferred via HTTP(S).</p>

<h2 id="generic-gateway-1">Generic Gateway</h2>

<p>Generic Gateway is disabled by default, but can easily be turned on during installation or upgrade of Brigade:</p>

<pre><code>$ helm install -n brigade brigade/brigade --set genericGateway.enabled=true
</code></pre>

<p>This will enable and configure the Generic Gateway Deployment/Services/RBAC permissions. However, be aware that Generic Gateway is not exposed outside the cluster by default. In case you are certain from a security perspective that you want to expose the Generic Gateway via a <a href="https://kubernetes.io/docs/concepts/services-networking/#loadbalancer">Kubernetes LoadBalancer Service</a>, you can install Brigade via the following command:</p>

<pre><code>$ helm install -n brigade brigade/brigade --set genericGateway.enabled=true,genericGateway.service.type=LoadBalancer
</code></pre>

<p>Alternatively, for enhanced security, you can install an SSL proxy (like <code>cert-manager</code>) and direct it to the Generic Gateway Service.</p>

<h2 id="using-the-generic-gateway">Using the Generic Gateway</h2>

<p>As mentioned, Generic Gateway accepts POST requests at <code>/simpleevents/v1/:projectID/:secret</code> and <code>/cloudevents/v02/:projectID/:secret</code> endpoint. These requests should also carry a JSON payload (either a SimpleEvent or a CloudEvent).</p>

<p>Moreover:
- <code>projectID</code> is the Brigade Project ID
- <code>secret</code> is a custom secret for this specific project, in order to properly authenticate Generic Gateway requests. In other words, each project that wants to accept Generic Gateway events should have its own Generic Gateway secret. This secret serves as a simple authentication mechanism.</p>

<p>When you create a new Brigade Project via Brig CLI, you can optionally create such a secret by using the Advanced Options during <code>brig project create</code>. This secret must contain only alphanumeric characters. If you provide an empty string, Brig will generate and output a secret for you.</p>

<p><em>Important</em>: If you do not go into &ldquo;Advanced Options&rdquo; during <code>brig project create</code>, a secret will not be created and you will not be able to use Generic Gateway for your project. However, you can always use <code>brig project create --replace</code> (or just <code>kubectl edit</code> your project Secret) to update your project and include a <code>genericGatewaySecret</code> string value.</p>

<h3 id="calling-the-simpleevents-endpoint">Calling the SimpleEvents endpoint</h3>

<p>When calling the Generic Gateway <code>simpleevents</code> endpoint, you must include a SimpleEvent with a custom JSON payload such as:</p>

<pre><code class="language-json">{
    &quot;ref&quot;: &quot;refs/heads/changes&quot;,
    &quot;commit&quot;: &quot;b60ad9543b2ddbbe73430dd6898b75883306cecc&quot;,
    &quot;key1&quot;: &quot;value1&quot;,
    &quot;key2&quot;: &quot;value2&quot;
}
</code></pre>

<p>You can use curl to test it:</p>

<pre><code class="language-bash">curl --header &quot;Content-Type: application/json&quot; \
  --request POST \
  --data '{
    &quot;ref&quot;: &quot;refs/heads/changes&quot;,
    &quot;commit&quot;: &quot;b60ad9543b2ddbbe73430dd6898b75883306cecc&quot;,
    &quot;key1&quot;: &quot;value1&quot;,
    &quot;key2&quot;: &quot;value2&quot;
}' \
  http://localhost:8000/simpleevents/v1/PROJECT_ID/SECRET
</code></pre>

<p>If you do not wish to provide any payload, you can send empty POST data or just an empty JSON object (<code>{}</code>).</p>

<hr />

<p><strong>NOTE</strong></p>

<p>If you plan to use this type of event with source control, you should specify <code>ref</code> and <code>commit</code> values. These are used to configure the specific revision that Brigade will pull from your repository. If both values are missing, your Build&rsquo;s <code>ref</code> will be set to <code>master</code>. Of course, you can also provide any other values you need.</p>

<hr />

<h3 id="calling-the-cloudevent-endpoint">Calling the CloudEvent endpoint</h3>

<p>When calling the Generic Gateway <code>cloudevents/v02</code> endpoint, you must include a valid <a href="https://github.com/cloudevents/spec/blob/v0.2/spec.md">0.2 CloudEvent</a> message such as:</p>

<pre><code class="language-json">{
    &quot;type&quot;:   &quot;com.example.file.created&quot;,
    &quot;source&quot;: &quot;/providers/Example.COM/storage/account#fileServices/default/{new-file}&quot;,
    &quot;id&quot;:     &quot;ea35b24ede421&quot;,
    &quot;specversion&quot;: &quot;0.2&quot;,
    &quot;data&quot;: {
        &quot;ref&quot;: &quot;refs/heads/changes&quot;,
        &quot;commit&quot;: &quot;63c09efb6eb544f41a48901a6d0cc6ddfa4adb28&quot;,
        &quot;key1&quot;: &quot;value1&quot;,
        &quot;key2&quot;: &quot;value2&quot;
  }
}
</code></pre>

<p>You can use curl to test it:</p>

<pre><code class="language-bash">curl --header &quot;Content-Type: application/json&quot; \
  --request POST \
  --data '{ &quot;type&quot;:   &quot;com.example.file.created&quot;,
    &quot;source&quot;: &quot;/providers/Example.COM/storage/account#fileServices/default/{new-file}&quot;,
    &quot;id&quot;:     &quot;ea35b24ede421&quot;,
    &quot;specversion&quot;: &quot;0.2&quot;,
    &quot;data&quot;: {
        &quot;ref&quot;: &quot;refs/heads/changes&quot;,
        &quot;commit&quot;: &quot;63c09efb6eb544f41a48901a6d0cc6ddfa4adb28&quot;,
        &quot;key1&quot;: &quot;value1&quot;,
        &quot;key2&quot;: &quot;value2&quot;
  }}' \
  http://localhost:8000/cloudevents/v02/PROJECT_ID/SECRET
</code></pre>

<p>Bear in mind that 0.2 Cloud Events specification requires non-empty and proper values for &ldquo;type&rdquo;,&ldquo;source&rdquo;,&ldquo;id&rdquo; and &ldquo;specversion&rdquo; (<a href="https://github.com/cloudevents/spec/blob/v0.2/spec.md#type">source</a>).</p>

<p>A CloudEvent may include domain-specific information in the <code>data</code> field (<a href="https://github.com/cloudevents/spec/blob/v0.2/spec.md#data-attribute">source</a>).</p>

<hr />

<p><strong>NOTE</strong></p>

<p>If you plan to use this type of event with source control, you should specify <code>ref</code> and <code>commit</code> values in the <code>data</code> field in order to to configure the specific revision that Brigade will pull from your repository. If both values are missing, your Build&rsquo;s <code>ref</code> will be set to <code>master</code>.</p>

<hr />

<h2 id="sample-brigade-js">Sample Brigade.js</h2>

<p>Here is a sample Brigade.js file that could be used as a base for your own scripts that respond to both Generic Gateway events.</p>

<pre><code class="language-javascript">const { events, Job } = require(&quot;brigadier&quot;);

events.on(&quot;simpleevent&quot;, (e, p) =&gt; {  // handler for a SimpleEvent
  var echo = new Job(&quot;echosimpleevent&quot;, &quot;alpine:3.8&quot;);
  echo.tasks = [
    &quot;echo Project &quot; + p.name,
    &quot;echo event type: $EVENT_TYPE&quot;
  ];
  echo.env = {
    &quot;EVENT_TYPE&quot;: e.type
  };
  echo.run();
});

events.on(&quot;cloudevent&quot;, (e, p) =&gt; { // handler for a CloudEvent
  var echo = new Job(&quot;echocloudevent&quot;, &quot;alpine:3.8&quot;);
  echo.tasks = [
    &quot;echo Project &quot; + p.name,
    &quot;echo event type: $EVENT_TYPE&quot;
  ];
  echo.env = {
    &quot;EVENT_TYPE&quot;: e.type
  };
  echo.run();
});
</code></pre>

<hr />

<p>Prev: <a href="dockerhub.md">Container Registry Integration</a> <code>|</code> Next: <a href="secrets.md">Using Secrets</a></p>

<p>Return to the <a href="index.md">Table of Contents</a></p>
<div class="edit-meta"><small>Last updated on January 1, 0001 / Published on January 1, 0001</small>
<br></div><nav class="pagination"><a class="nav nav-prev" href="/topics/gateways/" title="Gateways"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - Gateways</a>
<a class="nav nav-next" href="/topics/github/" title="GitHub Integration">Next - GitHub Integration <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav></article>
<footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">
<nav>
<ul>
<li class=""><a href="/">Home</a></li>

<li class=""><a href="/intro/">Getting Started</a>
<ul class="">
<li class=""><a href="/intro/overview/">Brigade Overview</a></li>
<li class=""><a href="/intro/install/">Installing Brigade</a></li>
<li class=""><a href="/intro/tutorial01/">Tutorial 1: Writing a CI pipeline</a></li>
<li class=""><a href="/intro/tutorial02/">Tutorial 2: Setup GitHub</a></li>
<li class=""><a href="/intro/tutorial03/">Tutorial 3: Projects &amp; Events</a></li>
<li class=""><a href="/intro/tutorial04/">Tutorial 4: Writing a Test</a></li>
<li class=""><a href="/intro/writing-efficient-pipelines/">Tutorial 5: Writing Efficient Pipelines</a></li>
</ul>
  
</li>

<li class="parent"><a href="/topics/">Topic Guides</a>
<ul class="sub-menu">
<li class=""><a href="/topics/scripting_advanced/">Advanced Scripting Guide</a></li>
<li class=""><a href="/topics/dockerhub/">Container Registry Integration</a></li>
<li class=""><a href="/topics/dependencies/">Dependencies</a></li>
<li class=""><a href="/topics/design/">Design</a></li>
<li class=""><a href="/topics/developers/">Developer Guide</a></li>
<li class=""><a href="/topics/gateways/">Gateways</a></li>
<li class="active"><a href="/topics/genericgateway/">Generic Gateway</a></li>
<li class=""><a href="/topics/github/">GitHub Integration</a></li>
<li class=""><a href="/topics/ingress/">Ingress</a></li>
<li class=""><a href="/topics/projects/">Managing Projects in Brigade</a></li>
<li class=""><a href="/topics/releasing/">Releasing Brigade</a></li>
<li class=""><a href="/topics/scripting/">Scripting Guide</a></li>
<li class=""><a href="/topics/secrets/">Secret Management</a></li>
<li class=""><a href="/topics/security/">Securing Brigade</a></li>
<li class=""><a href="/topics/storage/">Storage</a></li>
<li class=""><a href="/topics/testing/">Testing</a></li>
<li class=""><a href="/topics/javascript/">The Brigade.js API</a></li>
<li class=""><a href="/topics/readnext/">What to Read Next</a></li>
<li class=""><a href="/topics/workers/">Workers</a></li>
</ul>
  
</li>
</ul>
</nav>


<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
